import{_ as e,c as a,o as t,a3 as r}from"./chunks/framework.wrXFlTLz.js";const f=JSON.parse('{"title":"Introducing API version 4","description":"","frontmatter":{"editLink":false},"headers":[],"relativePath":"news/2018/07/29/introducing-api-4.md","filePath":"news/2018/07/29/introducing-api-4.md"}'),i={name:"news/2018/07/29/introducing-api-4.md"},o=r('<h1 id="introducing-api-version-4" tabindex="-1">Introducing API version 4 <a class="header-anchor" href="#introducing-api-version-4" aria-label="Permalink to &quot;Introducing API version 4&quot;">​</a></h1><h2 id="preface" tabindex="-1">Preface <a class="header-anchor" href="#preface" aria-label="Permalink to &quot;Preface&quot;">​</a></h2><p>As the amount of traffic increases, we come up with solutions to handle the traffic. Nowadays we handle 2 million requests per hour (4 million on peak), which is great, but it requires proper server capacity and effective software that scales with the amount of traffic that make this service reliable.</p><h2 id="openresty-luajit-and-lua-vips" tabindex="-1">OpenResty, LuaJIT and lua-vips <a class="header-anchor" href="#openresty-luajit-and-lua-vips" aria-label="Permalink to &quot;OpenResty, LuaJIT and lua-vips&quot;">​</a></h2><p>With API version 4 we decided to rewrite to complete code base to Lua and switch to <a href="https://openresty.org/en/" target="_blank" rel="noreferrer">OpenResty</a>, which turns <a href="https://nginx.org/" target="_blank" rel="noreferrer">nginx</a> and <a href="https://luajit.org/luajit.html" target="_blank" rel="noreferrer">LuaJIT</a> into a full-fledged scriptable web platform. For image handling and manipulation we still use the <a href="https://github.com/libvips/libvips" target="_blank" rel="noreferrer">libvips</a> image processing library under the hood. We have only moved from the <a href="https://github.com/libvips/php-vips" target="_blank" rel="noreferrer">PHP-binding</a> to the <a href="https://github.com/libvips/lua-vips" target="_blank" rel="noreferrer">Lua binding</a>.</p><p>You may wonder why we did this; it&#39;s because OpenResty is robust, fast and scales with the amount of traffic we are processing nowadays. One of the core benefits of OpenResty is that it is fully asynchronous and that our code can be written directly inside Nginx without using PHP-FPM and FastCGI. The amazing just-in-time (JIT) compilation and the integrated foreign function interface (FFI) in LuaJIT have also been motives to move away from PHP.</p><p>Perhaps you&#39;ve already noticed, <a href="/">https://wsrv.nl/</a> already states that API version 4 is running. This is not a mistake, our A/B testing went so well that we decided (on time of writing) to forward all traffic to API version 4.</p><h2 id="what-has-changed-for-the-end-user" tabindex="-1">What has changed for the end user? <a class="header-anchor" href="#what-has-changed-for-the-end-user" aria-label="Permalink to &quot;What has changed for the end user?&quot;">​</a></h2><p>Absolutely nothing, all parameters listed on API 3 still work on API 4. The only thing you might notice is when you process an image, that it will load faster. If you found something odd, don&#39;t hesitate to contact us.</p><p>We track support tickets, issues and feature requests using the <a href="https://github.com/weserv/images/issues" target="_blank" rel="noreferrer">GitHub issue tracker</a>.</p><h2 id="what-has-been-added" tabindex="-1">What has been added? <a class="header-anchor" href="#what-has-been-added" aria-label="Permalink to &quot;What has been added?&quot;">​</a></h2><p>We introduced some new parameters and a more flexible URI parser.</p><h3 id="masking" tabindex="-1">Masking <a class="header-anchor" href="#masking" aria-label="Permalink to &quot;Masking&quot;">​</a></h3><p>Controls the visible and non-visible area of the image. Previously the <a href="/docs/mask.html#mask-type"><code>&amp;mask</code></a> and <a href="/docs/mask.html#mask-trim"><code>&amp;mtrim</code></a> parameter were named as <code>&amp;shape</code> and <code>&amp;strim</code>, it was renamed to make room for new mask features.</p><ul><li>Mask type <a href="/docs/mask.html#mask-type"><code>&amp;mask</code></a>. Sets the mask type from a predefined list of shapes: <ul><li><code>circle</code></li><li><code>ellipse</code></li><li><code>triangle</code></li><li><code>triangle-180</code>: Triangle tilted upside down</li><li><code>pentagon</code></li><li><code>pentagon-180</code>: Pentagon tilted upside down</li><li><code>hexagon</code></li><li><code>square</code>: Square tilted 45 degrees</li><li><code>star</code>: 5-point star</li><li><code>heart</code></li></ul></li><li>Mask trim <a href="/docs/mask.html#mask-trim"><code>&amp;mtrim</code></a>. Removes the remaining whitespace from the mask.</li><li>Mask background <a href="/docs/mask.html#mask-background"><code>&amp;mbg</code></a>. Sets the background color of the mask.</li></ul><h3 id="flexible-uri-parser" tabindex="-1">Flexible URI parser <a class="header-anchor" href="#flexible-uri-parser" aria-label="Permalink to &quot;Flexible URI parser&quot;">​</a></h3><p>With API 4 we are supporting URI&#39;s starting with <code>http://</code> and <code>https://</code>. Previously this would result in an error to prevent BBCode parsers to fail on the double <code>http(s)://</code>-part. Because Markdown is increasingly becoming the standard for user input, we decided to make the URI parser more flexible. Note that we will still support <code>?url=ssl:…</code> and <code>?url=//…</code>-requests for backwards compatibility.</p><h2 id="where-can-i-view-the-code" tabindex="-1">Where can I view the code? <a class="header-anchor" href="#where-can-i-view-the-code" aria-label="Permalink to &quot;Where can I view the code?&quot;">​</a></h2><p>The code is available on the <a href="https://github.com/weserv/images/tree/4.x" target="_blank" rel="noreferrer">4.x branch</a>, this will become the default branch in the future.</p>',19),s=[o];function n(d,l,h,c,p,u){return t(),a("div",null,s)}const g=e(i,[["render",n]]);export{f as __pageData,g as default};
