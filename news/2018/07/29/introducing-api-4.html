<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Introducing API version 4 | wsrv.nl</title>
    <meta name="description" content="Image cache &amp; resize service">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.85C9ufDf.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DPMHZmlE.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CIBnVw_Q.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BBwxg22n.js">
    <link rel="modulepreload" href="/assets/news_2018_07_29_introducing-api-4.md.BnvTKuX5.lean.js">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#a72376">
    <meta name="msapplication-TileColor" content="#a72376">
    <meta name="theme-color" content="#ffffff">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar has-sidebar top" data-v-d5bf7c8e data-v-cc1d9f2e><div class="wrapper" data-v-cc1d9f2e><div class="container" data-v-cc1d9f2e><div class="title" data-v-cc1d9f2e><div class="VPNavBarTitle has-sidebar" data-v-cc1d9f2e data-v-d4488dd0><a class="title" href="/" data-v-d4488dd0><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/logo-dark.svg" alt="Logo" data-v-ab19afbb><!--]--><!--[--><img class="VPImage light logo" src="/logo.svg" alt="Logo" data-v-ab19afbb><!--]--><!--]--><!--]--><span data-v-d4488dd0>wsrv.nl</span><!--[--><!--]--></a></div></div><div class="content" data-v-cc1d9f2e><div class="content-body" data-v-cc1d9f2e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cc1d9f2e data-v-bdd98725><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-bdd98725 data-v-69351052><span class="vpi-search" aria-hidden="true" data-v-69351052></span><span class="text" data-v-69351052>Search</span><span class="keys" aria-hidden="true" data-v-69351052><kbd class="key-cmd" data-v-69351052>⌘</kbd><kbd class="key-ctrl" data-v-69351052>Ctrl</kbd><kbd data-v-69351052>K</kbd></span></button><!----><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cc1d9f2e data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Documentation</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/news/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>News</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/faq/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>FAQ</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-020be4db data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-d8fae6e2><span class="text" data-v-d8fae6e2><!----><span data-v-d8fae6e2>v5</span><span class="vpi-chevron-down text-icon" data-v-d8fae6e2></span></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><div class="items" data-v-fcd1d7a8><!--[--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link vp-external-link-icon" href="https://github.com/weserv/images/blob/5.x/CHANGELOG.md" target="_blank" rel="noreferrer" data-v-acfa8338><!--[--><span data-v-acfa8338>Changelog</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-fcd1d7a8 data-v-acfa8338><a class="VPLink link vp-external-link-icon" href="https://github.com/weserv/images/blob/5.x/Privacy-Policy.md" target="_blank" rel="noreferrer" data-v-acfa8338><!--[--><span data-v-acfa8338>Privacy Policy</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-cc1d9f2e data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-cc1d9f2e data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/weserv/images" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-cc1d9f2e data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>Appearance</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/weserv/images" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cc1d9f2e data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-cc1d9f2e><div class="divider-line" data-v-cc1d9f2e></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>News</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/news/2019/09/01/introducing-api-5" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Introducing API version 5</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/news/2018/07/29/introducing-api-4" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Introducing API version 4</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>On this page</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _news_2018_07_29_introducing-api-4" data-v-d668f7cc><div><h1 id="introducing-api-version-4" tabindex="-1">Introducing API version 4 <a class="header-anchor" href="#introducing-api-version-4" aria-label="Permalink to “Introducing API version 4”">​</a></h1><h2 id="preface" tabindex="-1">Preface <a class="header-anchor" href="#preface" aria-label="Permalink to “Preface”">​</a></h2><p>As the amount of traffic increases, we come up with solutions to handle the traffic. Nowadays we handle 2 million requests per hour (4 million on peak), which is great, but it requires proper server capacity and effective software that scales with the amount of traffic that make this service reliable.</p><h2 id="openresty-luajit-and-lua-vips" tabindex="-1">OpenResty, LuaJIT and lua-vips <a class="header-anchor" href="#openresty-luajit-and-lua-vips" aria-label="Permalink to “OpenResty, LuaJIT and lua-vips”">​</a></h2><p>With API version 4 we decided to rewrite to complete code base to Lua and switch to <a href="https://openresty.org/en/" target="_blank" rel="noreferrer">OpenResty</a>, which turns <a href="https://nginx.org/" target="_blank" rel="noreferrer">nginx</a> and <a href="https://luajit.org/luajit.html" target="_blank" rel="noreferrer">LuaJIT</a> into a full-fledged scriptable web platform. For image handling and manipulation we still use the <a href="https://github.com/libvips/libvips" target="_blank" rel="noreferrer">libvips</a> image processing library under the hood. We have only moved from the <a href="https://github.com/libvips/php-vips" target="_blank" rel="noreferrer">PHP-binding</a> to the <a href="https://github.com/libvips/lua-vips" target="_blank" rel="noreferrer">Lua binding</a>.</p><p>You may wonder why we did this; it&#39;s because OpenResty is robust, fast and scales with the amount of traffic we are processing nowadays. One of the core benefits of OpenResty is that it is fully asynchronous and that our code can be written directly inside Nginx without using PHP-FPM and FastCGI. The amazing just-in-time (JIT) compilation and the integrated foreign function interface (FFI) in LuaJIT have also been motives to move away from PHP.</p><p>Perhaps you&#39;ve already noticed, <a href="/">https://wsrv.nl/</a> already states that API version 4 is running. This is not a mistake, our A/B testing went so well that we decided (on time of writing) to forward all traffic to API version 4.</p><h2 id="what-has-changed-for-the-end-user" tabindex="-1">What has changed for the end user? <a class="header-anchor" href="#what-has-changed-for-the-end-user" aria-label="Permalink to “What has changed for the end user?”">​</a></h2><p>Absolutely nothing, all parameters listed on API 3 still work on API 4. The only thing you might notice is when you process an image, that it will load faster. If you found something odd, don&#39;t hesitate to contact us.</p><p>We track support tickets, issues and feature requests using the <a href="https://github.com/weserv/images/issues" target="_blank" rel="noreferrer">GitHub issue tracker</a>.</p><h2 id="what-has-been-added" tabindex="-1">What has been added? <a class="header-anchor" href="#what-has-been-added" aria-label="Permalink to “What has been added?”">​</a></h2><p>We introduced some new parameters and a more flexible URI parser.</p><h3 id="masking" tabindex="-1">Masking <a class="header-anchor" href="#masking" aria-label="Permalink to “Masking”">​</a></h3><p>Controls the visible and non-visible area of the image. Previously the <a href="/docs/mask#mask-type"><code>&amp;mask</code></a> and <a href="/docs/mask#mask-trim"><code>&amp;mtrim</code></a> parameter were named as <code>&amp;shape</code> and <code>&amp;strim</code>, it was renamed to make room for new mask features.</p><ul><li>Mask type <a href="/docs/mask#mask-type"><code>&amp;mask</code></a>. Sets the mask type from a predefined list of shapes: <ul><li><code>circle</code></li><li><code>ellipse</code></li><li><code>triangle</code></li><li><code>triangle-180</code>: Triangle tilted upside down</li><li><code>pentagon</code></li><li><code>pentagon-180</code>: Pentagon tilted upside down</li><li><code>hexagon</code></li><li><code>square</code>: Square tilted 45 degrees</li><li><code>star</code>: 5-point star</li><li><code>heart</code></li></ul></li><li>Mask trim <a href="/docs/mask#mask-trim"><code>&amp;mtrim</code></a>. Removes the remaining whitespace from the mask.</li><li>Mask background <a href="/docs/mask#mask-background"><code>&amp;mbg</code></a>. Sets the background color of the mask.</li></ul><h3 id="flexible-uri-parser" tabindex="-1">Flexible URI parser <a class="header-anchor" href="#flexible-uri-parser" aria-label="Permalink to “Flexible URI parser”">​</a></h3><p>With API 4 we are supporting URI&#39;s starting with <code>http://</code> and <code>https://</code>. Previously this would result in an error to prevent BBCode parsers to fail on the double <code>http(s)://</code>-part. Because Markdown is increasingly becoming the standard for user input, we decided to make the URI parser more flexible. Note that we will still support <code>?url=ssl:…</code> and <code>?url=//…</code>-requests for backwards compatibility.</p><h2 id="where-can-i-view-the-code" tabindex="-1">Where can I view the code? <a class="header-anchor" href="#where-can-i-view-the-code" aria-label="Permalink to “Where can I view the code?”">​</a></h2><p>The code is available on the <a href="https://github.com/weserv/images/tree/4.x" target="_blank" rel="noreferrer">4.x branch</a>, this will become the default branch in the future.</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/news/2019/09/01/introducing-api-5" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>Introducing API version 5</span><!--]--></a></div><div class="pager" data-v-1bcd8184><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-304c8b69 data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5>Released under the <a href='https://github.com/weserv/images/blob/5.x/LICENSE' target='_blank'>BSD 3-Clause License</a>.</p><p class="copyright" data-v-5b9946f5>Copyright &copy; 2007-present <a href="https://github.com/weserv/images/graphs/contributors" target="_blank">wsrv.nl contributors</a>.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"docs_adjustment.md\":\"EyGt8k9g\",\"docs_crop.md\":\"wD669QGH\",\"docs_fit.md\":\"DIFRZhrQ\",\"docs_format.md\":\"DPXU0GaA\",\"docs_index.md\":\"BoIt5GNM\",\"docs_mask.md\":\"BcbU8EMW\",\"docs_orientation.md\":\"YOFDupVy\",\"docs_quick-reference.md\":\"Bb2EkRdt\",\"docs_size.md\":\"5X4vBwno\",\"docs_supported-colors.md\":\"Dhw_mfqt\",\"faq_index.md\":\"D37bJYCA\",\"index.md\":\"By1Jc2zR\",\"news_2018_07_29_introducing-api-4.md\":\"BnvTKuX5\",\"news_2019_09_01_introducing-api-5.md\":\"BBTHwdZ-\",\"news_index.md\":\"BrWjykH2\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"wsrv.nl\",\"description\":\"Image cache &amp; resize service\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":{\"light\":\"/logo.svg\",\"dark\":\"/logo-dark.svg\",\"alt\":\"Logo\"},\"nav\":[{\"text\":\"Documentation\",\"link\":\"/docs/\",\"activeMatch\":\"/docs/\"},{\"text\":\"News\",\"link\":\"/news/\",\"activeMatch\":\"/news/\"},{\"text\":\"FAQ\",\"link\":\"/faq/\",\"activeMatch\":\"/faq/\"},{\"text\":\"v5\",\"items\":[{\"text\":\"Changelog\",\"link\":\"https://github.com/weserv/images/blob/5.x/CHANGELOG.md\"},{\"text\":\"Privacy Policy\",\"link\":\"https://github.com/weserv/images/blob/5.x/Privacy-Policy.md\"}]}],\"sidebar\":{\"/docs/\":{\"base\":\"/docs/\",\"items\":[{\"text\":\"Documentation\",\"items\":[{\"text\":\"Introduction\",\"link\":\"/\"},{\"text\":\"Quick reference\",\"link\":\"quick-reference\"},{\"text\":\"Size\",\"link\":\"size\"},{\"text\":\"Fit\",\"link\":\"fit\"},{\"text\":\"Crop\",\"link\":\"crop\"},{\"text\":\"Mask\",\"link\":\"mask\"},{\"text\":\"Orientation\",\"link\":\"orientation\"},{\"text\":\"Adjustment\",\"link\":\"adjustment\"},{\"text\":\"Format\",\"link\":\"format\"}]}]},\"/news/\":{\"base\":\"/news/\",\"items\":[{\"text\":\"News\",\"items\":[{\"text\":\"Introducing API version 5\",\"link\":\"2019/09/01/introducing-api-5\"},{\"text\":\"Introducing API version 4\",\"link\":\"2018/07/29/introducing-api-4\"}]}]}},\"editLink\":{\"pattern\":\"https://github.com/weserv/docs/edit/master/:path\",\"text\":\"Suggest changes to this page\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/weserv/images\"}],\"footer\":{\"message\":\"Released under the <a href='https://github.com/weserv/images/blob/5.x/LICENSE' target='_blank'>BSD 3-Clause License</a>.\",\"copyright\":\"Copyright &copy; 2007-present <a href=\\\"https://github.com/weserv/images/graphs/contributors\\\" target=\\\"_blank\\\">wsrv.nl contributors</a>.\"},\"search\":{\"provider\":\"algolia\",\"options\":{\"appId\":\"FVJ36DNUJC\",\"apiKey\":\"7563ec929d69f24be83776fd79b57a1b\",\"indexName\":\"images_weserv\"}}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true,\"additionalConfig\":{}}");</script>
    
  </body>
</html>